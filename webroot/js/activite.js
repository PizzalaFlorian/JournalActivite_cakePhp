$(function(){function e(){var e=location.href,t=e.substring(0,e.indexOf("/candidat",14));if(-1!=t.indexOf("http://localhost")){var i=location.pathname,n=e.indexOf(i),o=e.indexOf("/",n+1),r=e.substr(0,o);return r}return t}function t(e){return parseInt(e)<10?"0"+e:e}$(".RA_activ").change(function(){$(this).find("option:selected").attr("id")});var i=$(".calendar_td").width();$(".calendar_event").css({width:.85*i,"margin-left":(i-.85*i)/2}),$(".calendar_event").mousedown(function(){drag_id=$(this).attr("id")}),$(".ui-droppable").droppable({drop:function(){jour_drop=$(this).attr("id"),console.log("drop chez moi",jour_drop)}}),$(".calendar_event").draggable({containment:$("#containment_tr"),grid:[$(".calendar_td").width()+(i-.85*i)/8,1],delay:100,drag:function(e,i){var n=$(this),o=n.position(),r=$(this).parent().position();current_position=o.top-r.top-1;var a=n.css("margin-top"),d=parseInt(a.replace(".px","")),u=d+current_position;0>u&&(u=0),u=parseInt(u);var s=n.attr("id"),l=60*(u/10/4-1)*60,_=1e3*l,p=n.css("height"),c=parseInt(p.replace(".px","")),h=c/10/4*60*60,f=1e3*h,m=_+f;nouvelle_heure_depart=new Date,nouvelle_heure_depart.setTime(_),nouvelle_heure_fin=new Date,nouvelle_heure_fin.setTime(m),$("#"+s+"_date_debut_heure").html(t(nouvelle_heure_depart.getHours())),$("#"+s+"_date_debut_minute").html(t(nouvelle_heure_depart.getMinutes())),$("#"+s+"_date_fin_heure").html(t(nouvelle_heure_fin.getHours())),$("#"+s+"_date_fin_minute").html(t(nouvelle_heure_fin.getMinutes()))},stop:function(e,i){var n=$(this),o=n.position(),r=$(this).parent().position();current_position=o.top-r.top-1;var a=n.css("margin-top");console.log("new margin 2",a);var d=parseInt(a.replace(".px","")),u=d+current_position;0>u&&(u=0),u=parseInt(u);var s=n.attr("id"),l=60*(u/10/4-1)*60,_=1e3*l,p=n.css("height"),c=parseInt(p.replace(".px","")),h=c/10/4*60*60,f=1e3*h,m=_+f;if(nouvelle_heure_depart=new Date,nouvelle_heure_depart.setTime(_),nouvelle_heure_fin=new Date,nouvelle_heure_fin.setTime(m),$("#"+s+"_date_debut_heure").html(t(nouvelle_heure_depart.getHours())),$("#"+s+"_date_debut_minute").html(t(nouvelle_heure_depart.getMinutes())),$("#"+s+"_date_fin_heure").html(t(nouvelle_heure_fin.getHours())),$("#"+s+"_date_fin_minute").html(t(nouvelle_heure_fin.getMinutes())),console.log("Jai bougé"),"undefined"!=typeof jour_drop)var v=jour_drop;else var v=$(this).closest("td").attr("id");var g=v+" "+nouvelle_heure_depart.getHours()+":"+nouvelle_heure_depart.getMinutes()+":00",b=v+" "+nouvelle_heure_fin.getHours()+":"+nouvelle_heure_fin.getMinutes()+":00";$(".ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable").dialog("destroy"),$.ajax({url:"../occupation/editHeure/"+s,type:"POST",data:"CodeOccupation="+s+"&HeureDebut="+g+"&HeureFin="+b,dataType:"html",success:function(e,t){}}),$("#dialog").dialog("destroy"),$("#ui-dialog-title-dialog").dialog("destroy"),$("#gen_new_content").dialog("destroy"),$(".ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable").dialog("destroy")}}),$(".calendar_event").resizable({containment:".calendar_td",grid:[0,1],handles:"s",stop:function(e,t){var i=$(this),n=i.attr("id"),o=i.css("height");parseInt(o.replace(".px",""));console.log("changement de taille");var r=$(this).closest("td").attr("id"),a=r+" "+$("#"+n+"_date_fin_heure").html()+":"+$("#"+n+"_date_fin_minute").html()+":00";$("#dialog").dialog("destroy"),$("#ui-dialog-title-dialog").dialog("destroy"),$("#gen_new_content").dialog("destroy"),$(".ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable").dialog("destroy"),$.ajax({url:"../occupation/editHeureFin/"+n,type:"POST",data:"CodeOccupation="+n+"&HeureFin="+a,dataType:"html",success:function(e,t){}}),$("#dialog").dialog("destroy"),$("#ui-dialog-title-dialog").dialog("destroy"),$("#gen_new_content").dialog("destroy"),$(".ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable").dialog("destroy")},resize:function(e,t){var i=$(this),n=i.attr("id"),o=parseInt($("#"+n+"_date_debut_heure").html()),r=parseInt($("#"+n+"_date_debut_minute").html()),a=new Date;a.setHours(o,r,0,0);var d=a.getTime(),u=i.css("height"),s=parseInt(u.replace(".px","")),l=s/10/4*60*60*1e3,_=new Date;_.setTime(d+l),_.getHours()>=a.getHours()&&($("#"+n+"_date_fin_heure").html(_.getHours()),$("#"+n+"_date_fin_minute").html(_.getMinutes()))}}),$(document).on("contextmenu",".calendar_event,",function(e){var t=$(this);event_right_cliked=t.attr("id");var i=t.attr("id");return jour_deb=$(this).closest("td").attr("id"),console.log("jai clique droit",i),$("#click-menue").css({top:e.pageY,left:e.pageX}).show(),$("#paste-menue").hide(),$("#cp").click(function(e){if(console.log("copier out",i),buffer_event_id=i,buffer_height=$("#"+i).css("height"),null!=$("#"+i).css("top")){var t=parseInt($("#"+i+"_date_debut_heure").html()),n=parseInt($("#"+i+"_date_debut_minute").html()),o=60*t*60+60*n,r=o/60/60*4*10;buffer_margin=r+"px"}else buffer_margin=$("#"+i).css("margin-top");console.log("height",buffer_height),console.log("margin",buffer_margin),buffer_heure_debut=$("#"+i+"_date_debut_heure").html(),buffer_minute_debut=$("#"+i+"_date_debut_minute").html(),buffer_heure_fin=$("#"+i+"_date_fin_heure").html(),buffer_minute_fin=$("#"+i+"_date_fin_minute").html(),buffer_activite=$("#"+i+"_activite").html(),buffer_lieu=$("#"+i+"_lieu").html(),buffer_compagnie=$("#"+i+"_compagnie").html(),buffer_dispositif=$("#"+i+"_dispositif").html()}),e.preventDefault(),!1}),$("#sp").click(function(e){console.log("Supprimer"),$("#supp").html("Veuillez Confirmer la suppression");var t=event_right_cliked;$("#supp").dialog({bgiframe:!0,resizable:!0,height:200,modal:!0,beforeclose:function(e,t){$(this).dialog("destroy")},buttons:{Supprimer:function(){$(this).dialog("destroy"),$("#supp").html(""),$.ajax({url:"../occupation/delete/"+t,type:"POST",data:t,dataType:"html",success:function(e,t){console.log("ok")}}),$("#"+t).hide("highlight",{direction:"vertical",color:"#A60000"},2e3),$("#"+t).remove()},Annuler:function(){$(this).dialog("destroy"),$("#supp").html("")}}})}),$(document).click(function(e){$("#click-menue").hide(),$("#paste-menue").hide()}),$(document).on("contextmenu",".other_day,",function(e){return $("#vd").click(function(e){console.log("vider"),buffer_event_id="",buffer_height="",buffer_margin="",buffer_heure_debut="",buffer_minute_debut="",buffer_heure_fin="",buffer_minute_fin="",buffer_activite="",buffer_lieu="",buffer_compagnie="",buffer_dispositif=""}),null!=buffer_event_id&&$("#paste-menue").css({top:e.pageY,left:e.pageX}).show(),$("#click-menue").hide(),column_target=$(this),jour_deb=$(this).attr("id"),e.preventDefault(),!1}),$("#cl").click(function(t){console.log("coller dans ",jour_deb),console.log("new jour : ",jour_deb);var i=0,n=t.pageY-$(this).position().top,o=Math.round(n),r=String(o),a=r.length-1,d=r.substr(0,a),u=parseInt(d);u||(u=0);var s=10*u,l=60*(s/10/4-1)*60,_=1e3*l,p=parseInt(80),c=p/10/4*60*60,h=1e3*c,f=_+h;nouvelle_heure_depart=new Date,nouvelle_heure_depart.setTime(_),nouvelle_heure_fin=new Date,nouvelle_heure_fin.setTime(f);var m=parseInt($(this).attr("id")),v=m+60*nouvelle_heure_depart.getHours()*60+60*nouvelle_heure_depart.getMinutes(),g=m+60*nouvelle_heure_fin.getHours()*60+60*nouvelle_heure_fin.getMinutes(),b=(e()+"/admin/ajax/evenementcreation/ds/"+v+"/de/"+g+"/ag/"+i,0),w=buffer_activite,I=jour_deb+" "+buffer_heure_debut+":"+buffer_minute_debut+":00",y=jour_deb+" "+buffer_heure_fin+":"+buffer_minute_fin+":00",x=I.split(" "),T=x[1].split(":"),C=y.split(" "),k=C[1].split(":"),M=60*(60*parseInt(T[0])+parseInt(T[1])),H=60*(60*parseInt(k[0])+parseInt(k[1])),j=H-M;console.log("height",buffer_height),console.log("margin",buffer_margin),$("#ajax_load").html("");var D=$("<div></div>").appendTo(column_target).attr("class","calendar_event select_agenda_red").attr("id",b+"_main").css({height:buffer_height,marginTop:buffer_margin}),S=$("<div></div>").appendTo(D).attr("class","calendar_event_date").attr("id",b+"_calendar_event_date");$("<span>"+T[0]+"</span>").appendTo(S).attr("id",b+"_date_debut_heure");$("<span>:</span>").appendTo(S);$("<span>"+T[1]+"</span>").appendTo(S).attr("id",b+"_date_debut_minute");$("<span> - </span>").appendTo(S);$("<span>"+k[0]+"</span>").appendTo(S).attr("id",b+"_date_fin_heure");$("<span>:</span>").appendTo(S);$("<span>"+k[1]+"</span>").appendTo(S).attr("id",b+"_date_fin_minute"),$("#"+b+"_title").remove(),$("<div>"+w+"</div>").appendTo(D).attr("class","calendar_event_activite").attr("id",b+"_activite");if(null!=buffer_lieu){$("<div>"+buffer_lieu+"</div>").appendTo(D).attr("class","calendar_event_lieu").attr("id",b+"_lieu")}if(null!=buffer_compagnie){$("<div>"+buffer_compagnie+"</div>").appendTo(D).attr("class","calendar_event_compagnie").attr("id",b+"_compagnie")}if(null!=buffer_dispositif){$("<div>"+buffer_dispositif+"</div>").appendTo(D).attr("class","calendar_event_dispositif").attr("id",b+"_dispositif")}$("<div>Sauvegarde en cours</div>").appendTo(D).attr("id",b+"_tmp");D.corner(),$(".calendar_event_date").corner("top cc:#fff");var z=$(".calendar_td").width();D.css({width:.85*z,"margin-left":(z-.85*z)/2}),$.ajax({url:"../occupation/copier/",type:"POST",data:"CodeOccupation="+buffer_event_id+"&HeureDebut="+I+"&HeureFin="+y,dataType:"html",success:function(e,t){console.log(e);var i=e;$("#0_main").attr("id",i),$("#0_tmp").remove(),$("#0_activite").attr("id",i+"_activite"),$("#0_lieu").attr("id",i+"_lieu"),$("#0_compagnie").attr("id",i+"_compagnie"),$("#0_dispositif").attr("id",i+"_dispositif"),$("#0_calendar_event_date").attr("id",i+"_calendar_event_date"),$("#0_date_debut_heure").attr("id",i+"_date_debut_heure"),$("#0_date_debut_minute").attr("id",i+"_date_debut_minute"),$("#0_date_fin_heure").attr("id",i+"_date_fin_heure"),$("#0_date_fin_minute").attr("id",i+"_date_fin_minute")}}),$("#sp").click(function(e){var t=event_right_cliked;console.log("Supprimer"),$("#supp").html("Veuillez Confirmer la suppression"),$("#supp").dialog({bgiframe:!0,resizable:!0,height:200,modal:!0,beforeclose:function(e,t){$(this).dialog("destroy")},buttons:{Supprimer:function(){$(this).dialog("destroy"),$("#supp").html(""),$.ajax({url:"../occupation/delete/"+t,type:"POST",data:t,dataType:"html",success:function(e,t){console.log("ok")}}),$("#"+t).hide("highlight",{direction:"vertical",color:"#A60000"},2e3),$("#"+t).remove()},Annuler:function(){$(this).dialog("destroy"),$("#supp").html("")}}})}),D.draggable({containment:$("#containment_tr"),grid:[$(".calendar_td").width()+(z-.85*z)/8,1],delay:100,drag:function(e,t){var i=$(this),n=i.position(),o=$(this).parent().position();current_position=n.top-o.top-1;var r=i.css("margin-top"),a=parseInt(r.replace(".px","")),d=a+current_position;0>d&&(d=0),d=parseInt(d);var u=i.attr("id"),s=60*(d/10/4-1)*60,l=1e3*s,_=i.css("height"),p=parseInt(_.replace(".px","")),c=p/10/4*60*60,h=1e3*c,f=l+h;nouvelle_heure_depart=new Date,nouvelle_heure_depart.setTime(l),nouvelle_heure_fin=new Date,nouvelle_heure_fin.setTime(f),$("#"+u+"_date_debut_heure").html(nouvelle_heure_depart.getHours()),$("#"+u+"_date_debut_minute").html(nouvelle_heure_depart.getMinutes()),$("#"+u+"_date_fin_heure").html(nouvelle_heure_fin.getHours()),$("#"+u+"_date_fin_minute").html(nouvelle_heure_fin.getMinutes())},stop:function(e,t){var i=$(this),n=i.position(),o=$(this).parent().position();current_position=n.top-o.top-1;var r=i.css("margin-top");console.log("new margin 3",r);var a=parseInt(r.replace(".px","")),d=a+current_position;0>d&&(d=0),d=parseInt(d);var u=i.attr("id"),s=60*(d/10/4-1)*60,l=1e3*s,_=i.css("height"),p=parseInt(_.replace(".px","")),c=p/10/4*60*60,h=1e3*c,f=l+h;nouvelle_heure_depart=new Date,nouvelle_heure_depart.setTime(l),nouvelle_heure_fin=new Date,nouvelle_heure_fin.setTime(f),$("#"+u+"_date_debut_heure").html(nouvelle_heure_depart.getHours()),$("#"+u+"_date_debut_minute").html(nouvelle_heure_depart.getMinutes()),$("#"+u+"_date_fin_heure").html(nouvelle_heure_fin.getHours()),$("#"+u+"_date_fin_minute").html(nouvelle_heure_fin.getMinutes());var m=jour_drop,v=m+" "+nouvelle_heure_depart.getHours()+":"+nouvelle_heure_depart.getMinutes()+":00",g=m+" "+nouvelle_heure_fin.getHours()+":"+nouvelle_heure_fin.getMinutes()+":00";$(".ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable").dialog("destroy"),$.ajax({url:"../occupation/editHeure/"+u,type:"POST",data:"CodeOccupation="+u+"&HeureDebut="+v+"&HeureFin="+g,dataType:"html",success:function(e,t){}})}}),D.resizable({containment:".calendar_td",grid:[0,1],handles:"s",stop:function(e,t){var i=$(this),n=i.attr("id"),o=i.css("height"),r=(parseInt(o.replace(".px","")),$(this).closest("td").attr("id")),a=r+" "+$("#"+n+"_date_fin_heure").html()+":"+$("#"+n+"_date_fin_minute").html()+":00";$.ajax({url:"../occupation/editHeureFin/"+n,type:"POST",data:"CodeOccupation="+n+"&HeureFin="+a,dataType:"html",success:function(e,t){}})},resize:function(e,t){var i=$(this),n=i.attr("id"),o=parseInt($("#"+n+"_date_debut_heure").html()),r=parseInt($("#"+n+"_date_debut_minute").html()),a=new Date;a.setHours(o,r,0,0);var d=a.getTime(),u=i.css("height"),s=parseInt(u.replace(".px","")),l=s/10/4*60*60*1e3,_=new Date;_.setTime(d+l),_.getHours()>=a.getHours()&&($("#"+n+"_date_fin_heure").html(_.getHours()),$("#"+n+"_date_fin_minute").html(_.getMinutes()))}}),$("#md").click(function(e){var t=event_right_cliked;$("#dialog").dialog({bgiframe:!0,resizable:!0,height:720,width:500,modal:!0,overlay:{backgroundColor:"#000",opacity:.5},beforeclose:function(e,t){$(this).dialog("destroy")},open:function(e,i){var n=$("#"+t+"_date_debut_heure").html(),o=$("#"+t+"_date_debut_minute").html(),r=$("#"+t+"_date_fin_heure").html(),a=$("#"+t+"_date_fin_minute").html(),d=($("#"+t+"_title").html(),$("#"+t+"_lieu").html(),"");$("#ui-dialog-title-dialog").html("Détail"),$("#dialog").html("veuillez patienter pendant le chargement des données"),$.ajax({url:"../occupation/edit/"+t,type:"GET",data:t,dataType:"html",success:function(e,t){d=e,$("#dialog").html(d);var i=$("#edit_heure_debut").width();$("#edit_heure_debut").css({width:.2*i}),$("#edit_minute_debut").css({width:.2*i}),$("#edit_heure_fin").css({width:.2*i}),$("#edit_minute_fin").css({width:.2*i});for(var u="",s=0;24>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),u=s==parseInt(n)?u+'<option id="h_debut" selected>'+l+"</option>":u+'<option id="h_debut">'+l+"</option>"}for(var _="",s=0;60>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),_=s==parseInt(o)?_+'<option id="m_debut" selected>'+l+"</option>":_+'<option id="m_debut">'+l+"</option>"}for(var p="",s=parseInt(n);24>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),p=s==parseInt(r)?p+"<option selected>"+l+"</option>":p+"<option>"+l+"</option>"}var c="";if(r==n)for(var s=parseInt(o);60>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),c=s==parseInt(a)?c+"<option selected>"+l+"</option>":c+"<option>"+l+"</option>"}else for(var s=0;60>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),c=s==parseInt(a)?c+"<option selected>"+l+"</option>":c+"<option>"+l+"</option>"}$("#edit_heure_debut").html(u),$("#edit_minute_debut").html(_),$("#edit_heure_fin").html(p),$("#edit_minute_fin").html(c),$("#edit_heure_fin").change(function(e){r=$("#edit_heure_fin option:selected").html();var t="";if(n>=r)for(var i=parseInt(o)+1;60>i;i++){var d=0;10>i&&(d="0"+i),i>=10&&(d=i),t=i==parseInt(a)?t+"<option selected>"+d+"</option>":t+"<option>"+d+"</option>"}else for(var i=0;60>i;i++){var d=0;10>i&&(d="0"+i),i>=10&&(d=i),t=i==parseInt(a)?t+"<option selected>"+d+"</option>":t+"<option>"+d+"</option>"}$("#edit_minute_fin").html(t)}),$("#edit_minute_fin").change(function(e){a=$("#edit_minute_fin option:selected").html()}),$("#edit_heure_debut").change(function(e){console.log("click edit heure",$("#edit_heure_debut option:selected").html());var t=$("#edit_heure_debut option:selected").html();n=t;for(var i="",d=parseInt(t);24>d;d++){var u=0;10>d&&(u="0"+d),d>=10&&(u=d),i=d==parseInt(r)?i+"<option selected>"+u+"</option>":i+"<option>"+u+"</option>"}var s="";if(t>=r)for(var d=parseInt(o)+1;60>d;d++){var u=0;10>d&&(u="0"+d),d>=10&&(u=d),s=d==parseInt(a)?s+"<option selected>"+u+"</option>":s+"<option>"+u+"</option>"}else for(var d=0;60>d;d++){var u=0;10>d&&(u="0"+d),d>=10&&(u=d),s=d==parseInt(a)?s+"<option selected>"+u+"</option>":s+"<option>"+u+"</option>"}$("#edit_heure_fin").html(i),$("#edit_minute_fin").html(s)}),$("#edit_minute_debut").change(function(e){console.log("click edit minute",$("#edit_minute_debut option:selected").html());var t=$("#edit_minute_debut option:selected").html(),i="";if(n>=r)for(var o=parseInt(t)+1;60>o;o++){var d=0;10>o&&(d="0"+o),o>=10&&(d=o),i=o==parseInt(a)?i+"<option selected>"+d+"</option>":i+"<option>"+d+"</option>"}else for(var o=0;60>o;o++){var d=0;10>o&&(d="0"+o),o>=10&&(d=o),i=o==parseInt(a)?i+"<option selected>"+d+"</option>":i+"<option>"+d+"</option>"}$("#edit_minute_fin").html(i)})}})},buttons:{Modifier:function(){var e=$("#CodeActivite").find("option:selected").attr("value"),i=$("#CodeActivite").find("option:selected").html(),n=$("#CodeLieux").find("option:selected").attr("value"),o=$("#CodeLieux").find("option:selected").html(),r=$("#CodeCompagnie").find("option:selected").attr("value"),a=$("#CodeCompagnie").find("option:selected").html(),d=$("#CodeDispositif").find("option:selected").attr("value"),u=$("#CodeDispositif").find("option:selected").html(),s=jour_deb+" "+$("#edit_heure_debut").find("option:selected").html()+":"+$("#edit_minute_debut").find("option:selected").html()+":00",l=jour_deb+" "+$("#edit_heure_fin").find("option:selected").html()+":"+$("#edit_minute_fin").find("option:selected").html()+":00";console.log("event",s);var _=s.split(" "),p=_[1].split(":"),c=l.split(" "),h=c[1].split(":"),f=60*(60*parseInt(p[0])+parseInt(p[1])),m=60*(60*parseInt(h[0])+parseInt(h[1])),v=m-f,g=f/60/60*4*10,b=v/60/60*4*10;$("#"+t).css("height",b+"px"),$("#"+t).css("marginTop",g+"px"),$("#"+t+"_date_debut_heure").replaceWith("<span>"+p[0]+"</span>"),$("#"+t+"_date_debut_minute").replaceWith("<span>"+p[1]+"</span>"),$("#"+t+"_date_fin_heure").replaceWith("<span>"+h[0]+"</span>"),$("#"+t+"_date_fin_minute").replaceWith("<span>"+h[1]+"</span>");if(b>=60){$("#"+t+"_activite").replaceWith('<div id="'+t+'_activite">'+i+"</div>")}if(b>=140){$("#"+t+"_lieu").replaceWith('<div id="'+t+'_lieu">'+o+"</div>")}if(b>=180){$("#"+t+"_compagnie").replaceWith('<div id="'+t+'_compagnie">'+a+"</div>"),$("#"+t+"_dispositif").replaceWith('<div id="'+t+'_dispositif">'+u+"</div>")}$.ajax({url:"../occupation/edit/"+t,type:"POST",data:"CodeOccupation="+t+"&HeureDebut="+s+"&HeureFin="+l+"&CodeLieux="+n+"&CodeActivite="+e+"&CodeCompagnie="+r+"&CodeDispositif="+d,dataType:"html",success:function(e,t){console.log("modif success")}}),$(this).dialog("destroy")}}})})}),$(".calendar_td").dblclick(function(t){var i=$(this).attr("id"),n=0,o=t.pageY-$(this).position().top,r=Math.round(o),a=String(r),d=a.length-1,u=a.substr(0,d),s=parseInt(u);s||(s=0);var l=10*s,_=60*(l/10/4-1)*60,p=1e3*_,c=parseInt(80),h=c/10/4*60*60,f=1e3*h,m=p+f;nouvelle_heure_depart=new Date,nouvelle_heure_depart.setTime(p),nouvelle_heure_fin=new Date,nouvelle_heure_fin.setTime(m);var v=parseInt($(this).attr("id")),g=v+60*nouvelle_heure_depart.getHours()*60+60*nouvelle_heure_depart.getMinutes(),b=v+60*nouvelle_heure_fin.getHours()*60+60*nouvelle_heure_fin.getMinutes(),w=nouvelle_heure_depart.getMinutes();10>w&&(w="0"+w);var I=nouvelle_heure_depart.getHours();10>I&&(I="0"+I);var y=nouvelle_heure_fin.getMinutes();10>y&&(y="0"+y);var x=nouvelle_heure_fin.getHours();10>x&&(x="0"+x),$("#new_event_day").val(i),$("#new_event_heure_debut").val(I+":"+w+":00"),$("#new_event_heure_fin").val(x+":"+y+":00");var T=$("#new_heure_debut").width();$("#new_heure_debut").css({width:T}),$("#new_minute_debut").css({width:T}),$("#new_heure_fin").css({width:T}),$("#new_minute_fin").css({width:T});for(var C="",k=0;24>k;k++){var M=0;10>k&&(M="0"+k),k>=10&&(M=k),C=k==parseInt(I)?C+'<option id="h_debut" selected>'+M+"</option>":C+'<option id="h_debut">'+M+"</option>"}for(var H="",k=0;60>k;k++){var M=0;10>k&&(M="0"+k),k>=10&&(M=k),H=k==parseInt(w)?H+'<option id="m_debut" selected>'+M+"</option>":H+'<option id="m_debut">'+M+"</option>"}for(var j="",k=parseInt(I);24>k;k++){var M=0;10>k&&(M="0"+k),k>=10&&(M=k),j=k==parseInt(x)?j+"<option selected>"+M+"</option>":j+"<option>"+M+"</option>"}var D="";if(x==I)for(var k=parseInt(w);60>k;k++){var M=0;10>k&&(M="0"+k),k>=10&&(M=k),D=k==parseInt(y)?D+"<option selected>"+M+"</option>":D+"<option>"+M+"</option>"}else for(var k=0;60>k;k++){var M=0;10>k&&(M="0"+k),k>=10&&(M=k),D=k==parseInt(y)?D+"<option selected>"+M+"</option>":D+"<option>"+M+"</option>"}$("#new_heure_debut").html(C),$("#new_minute_debut").html(H),$("#new_heure_fin").html(j),$("#new_minute_fin").html(D),$("#new_heure_fin").change(function(e){x=$("#new_heure_fin option:selected").html();var t="";if(I>=x)for(var i=parseInt(w)+1;60>i;i++){var n=0;10>i&&(n="0"+i),i>=10&&(n=i),t=i==parseInt(y)?t+"<option selected>"+n+"</option>":t+"<option>"+n+"</option>"}else for(var i=0;60>i;i++){var n=0;10>i&&(n="0"+i),i>=10&&(n=i),t=i==parseInt(y)?t+"<option selected>"+n+"</option>":t+"<option>"+n+"</option>"}$("#new_minute_fin").html(t)}),$("#new_minute_fin").change(function(e){y=$("#new_minute_fin option:selected").html()}),$("#new_heure_debut").change(function(e){console.log("click new heure",$("#new_heure_debut option:selected").html());var t=$("#new_heure_debut option:selected").html();I=t;for(var i="",n=parseInt(t);24>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),i=n==parseInt(x)?i+"<option selected>"+o+"</option>":i+"<option>"+o+"</option>"}var r="";if(t>=x)for(var n=parseInt(w)+1;60>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),r=n==parseInt(y)?r+"<option selected>"+o+"</option>":r+"<option>"+o+"</option>"}else for(var n=0;60>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),r=n==parseInt(y)?r+"<option selected>"+o+"</option>":r+"<option>"+o+"</option>"}$("#new_heure_fin").html(i),$("#new_minute_fin").html(r)}),$("#new_minute_debut").change(function(e){console.log("click new minute",$("#new_minute_debut option:selected").html());var t=$("#new_minute_debut option:selected").html(),i="";if(I>=x)for(var n=parseInt(t)+1;60>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),i=n==parseInt(y)?i+"<option selected>"+o+"</option>":i+"<option>"+o+"</option>"}else for(var n=0;60>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),i=n==parseInt(y)?i+"<option selected>"+o+"</option>":i+"<option>"+o+"</option>"}$("#new_minute_fin").html(i)});var S=(e()+"/admin/ajax/evenementcreation/ds/"+g+"/de/"+b+"/ag/"+n,0);$("#gen_new_content").dialog({bgiframe:!0,resizable:!0,height:700,width:500,modal:!0,overlay:{backgroundColor:"#000",opacity:.5},beforeclose:function(e,t){$(this).dialog("destroy"),$("#new_event_categorieActivite").val(""),$("#new_event_categorieLieu").val(""),$("#new_event_lieu").val(""),$("#new_event_compagnie").val(""),$("#new_event_dispositif").val(""),$("#new_event_codeActivite").val(""),$("#0").remove()},buttons:{Enregistrer:function(){$(this).dialog("destroy");var e=$("#new_event_codeActivite").find("option:selected").attr("id"),t=$("#new_event_codeActivite").find("option:selected").html(),n=$("#new_event_lieu").find("option:selected").attr("id"),o=$("#new_event_compagnie").find("option:selected").attr("id"),r=$("#new_event_dispositif").find("option:selected").attr("id"),a=i+" "+$("#new_heure_debut option:selected").html()+":"+$("#new_minute_debut option:selected").html()+":00",d=i+" "+$("#new_heure_fin option:selected").html()+":"+$("#new_minute_fin option:selected").html()+":00";console.log("event",a);var u=a.split(" "),s=u[1].split(":"),l=d.split(" "),_=l[1].split(":"),p=60*(60*parseInt(s[0])+parseInt(s[1])),c=60*(60*parseInt(_[0])+parseInt(_[1])),h=c-p,f=p/60/60*4*10,m=h/60/60*4*10;console.log("height",m);var v=($("#"+S).css("height",m+"px"),$("#"+S).css("marginTop",f+"px"),$("<div></div>").appendTo(z).attr("class","calendar_event_date").attr("id",S+"_calendar_event_date"));$("<span>"+s[0]+"</span>").appendTo(v).attr("id",S+"_date_debut_heure");$("<span>:</span>").appendTo(v);$("<span>"+s[1]+"</span>").appendTo(v).attr("id",S+"_date_debut_minute");$("<span> - </span>").appendTo(v);$("<span>"+_[0]+"</span>").appendTo(v).attr("id",S+"_date_fin_heure");$("<span>:</span>").appendTo(v);$("<span>"+_[1]+"</span>").appendTo(v).attr("id",S+"_date_fin_minute"),$("#"+S+"_title").remove(),$("<div>"+t+"</div>").appendTo(z).attr("class","calendar_event_title").attr("id",S+"_title"),$("<div>Sauvegarde en cours</div>").appendTo(z).attr("id",S+"_tmp");z.corner(),$(".calendar_event_date").corner("top cc:#fff");var g=$(".calendar_td").width();z.css({width:.85*g,"margin-left":(g-.85*g)/2}),$.ajax({url:"../occupation/add",type:"POST",data:"HeureDebut="+a+"&HeureFin="+d+"&CodeLieux="+n+"&CodeActivite="+e+"&CodeCompagnie="+o+"&CodeDispositif="+r,dataType:"html",success:function(e,t){var i=e;$("#0_title").attr("id",i+"_activite"),$("#0_tmp").remove(),$("#0").attr("id",i),$("#0_calendar_event_date").attr("id",i+"_calendar_event_date"),$("#0_date_debut_heure").attr("id",i+"_date_debut_heure"),$("#0_date_debut_minute").attr("id",i+"_date_debut_minute"),$("#0_date_fin_heure").attr("id",i+"_date_fin_heure"),$("#0_date_fin_minute").attr("id",i+"_date_fin_minute")}}),$("#new_event_categorieActivite").val(""),$("#new_event_categorieLieu").val(""),$("#new_event_codeActivite").val(""),$("#new_event_lieu").val(""),$("#new_event_compagnie").val(""),$("#new_event_dispositif").val(""),$("#new_event_heure_debut").val(""),$("#new_event_heure_fin").val(""),$("#new_event_day").val("")},Annuler:function(){$(this).dialog("destroy"),$("#ajax_load").html("Cr&eacute;ation de l'&eacute;v&eacute;nement annul&eacute;e."),$("#"+S).hide("highlight",{direction:"vertical",color:"#A60000"},1e3),$("#new_event_title").val(""),$("#new_event_lieu").val(""),$("#new_event_codeActivite").val(""),$("#new_event_categorieActivite").val(""),$("#new_event_categorieLieu").val(""),$("#new_event_lieu").val(""),$("#new_event_compagnie").val(""),$("#new_event_dispositif").val("")}}}),$("#ajax_load").html("");var z=$("<div></div>").appendTo($(this)).attr("class","calendar_event select_agenda_red").attr("id",S).css({height:"80px",marginTop:l+"px"});$("<div>(en cours de sauvegarde)</div>").appendTo(z).attr("class","calendar_event_title").attr("id",S+"_title");z.corner(),$(".calendar_event_date").corner("top cc:#fff");var A=$(".calendar_td").width();z.css({width:.85*A,"margin-left":(A-.85*A)/2}),$("#cp").click(function(e){var t=event_right_cliked;console.log("copier from new event_id",t),buffer_event_id=t,buffer_height=$("#"+t).css("height"),console.log("copy from new top",$("#"+t).css("top")),buffer_margin=$("#"+t).css("top"),console.log("copier from new height",buffer_height),console.log("copier from new margin",buffer_margin),buffer_heure_debut=$("#"+t+"_date_debut_heure").html(),buffer_minute_debut=$("#"+t+"_date_debut_minute").html(),buffer_heure_fin=$("#"+t+"_date_fin_heure").html(),buffer_minute_fin=$("#"+t+"_date_fin_minute").html(),buffer_activite=$("#"+t+"_activite").html(),buffer_lieu=$("#"+t+"_lieu").html(),buffer_compagnie=$("#"+t+"_compagnie").html(),buffer_dispositif=$("#"+t+"_dispositif").html()}),$("#sp").click(function(e){var t=event_right_cliked;console.log("Supprimer"),$("#supp").html("Veuillez Confirmer la suppression"),$("#supp").dialog({bgiframe:!0,resizable:!0,height:200,modal:!0,beforeclose:function(e,t){$(this).dialog("destroy")},buttons:{Supprimer:function(){$(this).dialog("destroy"),$("#supp").html(""),$.ajax({url:"../occupation/delete/"+t,type:"POST",data:t,dataType:"html",success:function(e,t){console.log("ok")}}),$("#"+t).hide("highlight",{direction:"vertical",color:"#A60000"},2e3),$("#"+t).remove()},Annuler:function(){$(this).dialog("destroy"),$("#supp").html("")}}})}),z.draggable({containment:$("#containment_tr"),grid:[$(".calendar_td").width()+(A-.85*A)/8,1],delay:100,drag:function(e,t){var i=$(this),n=i.position(),o=$(this).parent().position();current_position=n.top-o.top-1;var r=i.css("margin-top"),a=parseInt(r.replace(".px","")),d=a+current_position;0>d&&(d=0),d=parseInt(d);var u=i.attr("id"),s=60*(d/10/4-1)*60,l=1e3*s,_=i.css("height"),p=parseInt(_.replace(".px","")),c=p/10/4*60*60,h=1e3*c,f=l+h;nouvelle_heure_depart=new Date,nouvelle_heure_depart.setTime(l),nouvelle_heure_fin=new Date,nouvelle_heure_fin.setTime(f),$("#"+u+"_date_debut_heure").html(nouvelle_heure_depart.getHours()),$("#"+u+"_date_debut_minute").html(nouvelle_heure_depart.getMinutes()),$("#"+u+"_date_fin_heure").html(nouvelle_heure_fin.getHours()),$("#"+u+"_date_fin_minute").html(nouvelle_heure_fin.getMinutes())},stop:function(e,t){var i=$(this),n=i.position(),o=$(this).parent().position();current_position=n.top-o.top-1;var r=i.css("margin-top");console.log("new margin 1",r);var a=parseInt(r.replace(".px","")),d=a+current_position;0>d&&(d=0),d=parseInt(d);var u=i.attr("id"),s=60*(d/10/4-1)*60,l=1e3*s,_=i.css("height"),p=parseInt(_.replace(".px","")),c=p/10/4*60*60,h=1e3*c,f=l+h;nouvelle_heure_depart=new Date,nouvelle_heure_depart.setTime(l),nouvelle_heure_fin=new Date,nouvelle_heure_fin.setTime(f),$("#"+u+"_date_debut_heure").html(nouvelle_heure_depart.getHours()),$("#"+u+"_date_debut_minute").html(nouvelle_heure_depart.getMinutes()),$("#"+u+"_date_fin_heure").html(nouvelle_heure_fin.getHours()),$("#"+u+"_date_fin_minute").html(nouvelle_heure_fin.getMinutes());var m=jour_drop,v=m+" "+nouvelle_heure_depart.getHours()+":"+nouvelle_heure_depart.getMinutes()+":00",g=m+" "+nouvelle_heure_fin.getHours()+":"+nouvelle_heure_fin.getMinutes()+":00";$(".ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable").dialog("destroy"),$.ajax({url:"../occupation/editHeure/"+u,type:"POST",data:"CodeOccupation="+u+"&HeureDebut="+v+"&HeureFin="+g,dataType:"html",success:function(e,t){}})}}),z.resizable({containment:".calendar_td",grid:[0,1],handles:"s",stop:function(e,t){var i=$(this),n=i.attr("id"),o=i.css("height"),r=(parseInt(o.replace(".px","")),$(this).closest("td").attr("id")),a=r+" "+$("#"+n+"_date_fin_heure").html()+":"+$("#"+n+"_date_fin_minute").html()+":00";$.ajax({url:"../occupation/editHeureFin/"+n,type:"POST",data:"CodeOccupation="+n+"&HeureFin="+a,dataType:"html",success:function(e,t){}})},resize:function(e,t){var i=$(this),n=i.attr("id"),o=parseInt($("#"+n+"_date_debut_heure").html()),r=parseInt($("#"+n+"_date_debut_minute").html()),a=new Date;a.setHours(o,r,0,0);var d=a.getTime(),u=i.css("height"),s=parseInt(u.replace(".px","")),l=s/10/4*60*60*1e3,_=new Date;_.setTime(d+l),_.getHours()>=a.getHours()&&($("#"+n+"_date_fin_heure").html(_.getHours()),$("#"+n+"_date_fin_minute").html(_.getMinutes()))}}),$("#md").click(function(e){var t=event_right_cliked;console.log("jai clique",t),$("#dialog").dialog({bgiframe:!0,resizable:!0,height:720,width:500,modal:!0,overlay:{backgroundColor:"#000",opacity:.5},beforeclose:function(e,t){$(this).dialog("destroy")},open:function(e,i){var n=$("#"+t+"_date_debut_heure").html(),o=$("#"+t+"_date_debut_minute").html(),r=$("#"+t+"_date_fin_heure").html(),a=$("#"+t+"_date_fin_minute").html(),d=($("#"+t+"_title").html(),$("#"+t+"_lieu").html(),"");$("#ui-dialog-title-dialog").html("Détail"),$("#dialog").html("veuillez patienter pendant le chargement des données"),$.ajax({url:"../occupation/edit/"+t,type:"GET",data:t,dataType:"html",success:function(e,t){d=e,$("#dialog").html(d);var i=$("#edit_heure_debut").width();$("#edit_heure_debut").css({width:.2*i}),$("#edit_minute_debut").css({width:.2*i}),$("#edit_heure_fin").css({width:.2*i}),$("#edit_minute_fin").css({width:.2*i});for(var u="",s=0;24>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),u=s==parseInt(n)?u+'<option id="h_debut" selected>'+l+"</option>":u+'<option id="h_debut">'+l+"</option>"}for(var _="",s=0;60>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),_=s==parseInt(o)?_+'<option id="m_debut" selected>'+l+"</option>":_+'<option id="m_debut">'+l+"</option>"}for(var p="",s=parseInt(n);24>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),p=s==parseInt(r)?p+"<option selected>"+l+"</option>":p+"<option>"+l+"</option>";
}var c="";if(r==n)for(var s=parseInt(o);60>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),c=s==parseInt(a)?c+"<option selected>"+l+"</option>":c+"<option>"+l+"</option>"}else for(var s=0;60>s;s++){var l=0;10>s&&(l="0"+s),s>=10&&(l=s),c=s==parseInt(a)?c+"<option selected>"+l+"</option>":c+"<option>"+l+"</option>"}$("#edit_heure_debut").html(u),$("#edit_minute_debut").html(_),$("#edit_heure_fin").html(p),$("#edit_minute_fin").html(c),$("#edit_heure_fin").change(function(e){r=$("#edit_heure_fin option:selected").html();var t="";if(n>=r)for(var i=parseInt(o)+1;60>i;i++){var d=0;10>i&&(d="0"+i),i>=10&&(d=i),t=i==parseInt(a)?t+"<option selected>"+d+"</option>":t+"<option>"+d+"</option>"}else for(var i=0;60>i;i++){var d=0;10>i&&(d="0"+i),i>=10&&(d=i),t=i==parseInt(a)?t+"<option selected>"+d+"</option>":t+"<option>"+d+"</option>"}$("#edit_minute_fin").html(t)}),$("#edit_minute_fin").change(function(e){a=$("#edit_minute_fin option:selected").html()}),$("#edit_heure_debut").change(function(e){console.log("click edit heure",$("#edit_heure_debut option:selected").html());var t=$("#edit_heure_debut option:selected").html();n=t;for(var i="",d=parseInt(t);24>d;d++){var u=0;10>d&&(u="0"+d),d>=10&&(u=d),i=d==parseInt(r)?i+"<option selected>"+u+"</option>":i+"<option>"+u+"</option>"}var s="";if(t>=r)for(var d=parseInt(o)+1;60>d;d++){var u=0;10>d&&(u="0"+d),d>=10&&(u=d),s=d==parseInt(a)?s+"<option selected>"+u+"</option>":s+"<option>"+u+"</option>"}else for(var d=0;60>d;d++){var u=0;10>d&&(u="0"+d),d>=10&&(u=d),s=d==parseInt(a)?s+"<option selected>"+u+"</option>":s+"<option>"+u+"</option>"}$("#edit_heure_fin").html(i),$("#edit_minute_fin").html(s)}),$("#edit_minute_debut").change(function(e){console.log("click edit minute",$("#edit_minute_debut option:selected").html());var t=$("#edit_minute_debut option:selected").html(),i="";if(n>=r)for(var o=parseInt(t)+1;60>o;o++){var d=0;10>o&&(d="0"+o),o>=10&&(d=o),i=o==parseInt(a)?i+"<option selected>"+d+"</option>":i+"<option>"+d+"</option>"}else for(var o=0;60>o;o++){var d=0;10>o&&(d="0"+o),o>=10&&(d=o),i=o==parseInt(a)?i+"<option selected>"+d+"</option>":i+"<option>"+d+"</option>"}$("#edit_minute_fin").html(i)})}})},buttons:{Modifier:function(){var e=$("#CodeActivite").find("option:selected").attr("value"),n=$("#CodeActivite").find("option:selected").html(),o=$("#CodeLieux").find("option:selected").attr("value"),r=$("#CodeLieux").find("option:selected").html(),a=$("#CodeCompagnie").find("option:selected").attr("value"),d=$("#CodeCompagnie").find("option:selected").html(),u=$("#CodeDispositif").find("option:selected").attr("value"),s=$("#CodeDispositif").find("option:selected").html(),l=i+" "+$("#edit_heure_debut").find("option:selected").html()+":"+$("#edit_minute_debut").find("option:selected").html()+":00",_=i+" "+$("#edit_heure_fin").find("option:selected").html()+":"+$("#edit_minute_fin").find("option:selected").html()+":00";console.log("event",l);var p=l.split(" "),c=p[1].split(":"),h=_.split(" "),f=h[1].split(":"),m=60*(60*parseInt(c[0])+parseInt(c[1])),v=60*(60*parseInt(f[0])+parseInt(f[1])),g=v-m,b=m/60/60*4*10,w=g/60/60*4*10;$("#"+t).css("height",w+"px"),$("#"+t).css("marginTop",b+"px"),$("#"+t+"_date_debut_heure").replaceWith("<span>"+c[0]+"</span>"),$("#"+t+"_date_debut_minute").replaceWith("<span>"+c[1]+"</span>"),$("#"+t+"_date_fin_heure").replaceWith("<span>"+f[0]+"</span>"),$("#"+t+"_date_fin_minute").replaceWith("<span>"+f[1]+"</span>");if(w>=60){$("#"+t+"_activite").replaceWith('<div id="'+t+'_activite">'+n+"</div>")}if(w>=140){$("#"+t+"_lieu").replaceWith('<div id="'+t+'_lieu">'+r+"</div>")}if(w>=180){$("#"+t+"_compagnie").replaceWith('<div id="'+t+'_compagnie">'+d+"</div>"),$("#"+t+"_dispositif").replaceWith('<div id="'+t+'_dispositif">'+s+"</div>")}$("<div>Sauvegarde en cours</div>").appendTo(z).attr("id",t+"_tmp");$.ajax({url:"../occupation/edit/"+t,type:"POST",data:"CodeOccupation="+t+"&HeureDebut="+l+"&HeureFin="+_+"&CodeLieux="+o+"&CodeActivite="+e+"&CodeCompagnie="+a+"&CodeDispositif="+u,dataType:"html",success:function(e,i){console.log("modif success"),$("#"+t+"_tmp").remove()}}),$(this).dialog("destroy")}}})})}),$("#md").click(function(e){var t=event_right_cliked;console.log("jai clique calendar event",t),$("#dialog").dialog({bgiframe:!0,resizable:!0,height:700,width:500,modal:!0,overlay:{backgroundColor:"#000",opacity:.5},beforeclose:function(e,t){$(this).dialog("destroy")},open:function(e,i){heure_debut=$("#"+t+"_date_debut_heure").html(),minute_debut=$("#"+t+"_date_debut_minute").html(),heure_fin=$("#"+t+"_date_fin_heure").html(),minute_fin=$("#"+t+"_date_fin_minute").html();var n=($("#"+t+"_title").html(),$("#"+t+"_lieu").html(),"");$("#ui-dialog-title-dialog").html("Détail"),$("#dialog").html("veuillez patienter pendant le chargement des données"),$.ajax({url:"../occupation/edit/"+t,type:"GET",data:t,dataType:"html",success:function(e,t){n=e,$("#dialog").html(n);var i=$("#edit_heure_debut").width();$("#edit_heure_debut").css({width:.2*i}),$("#edit_minute_debut").css({width:.2*i}),$("#edit_heure_fin").css({width:.2*i}),$("#edit_minute_fin").css({width:.2*i});for(var o="",r=0;24>r;r++){var a=0;10>r&&(a="0"+r),r>=10&&(a=r),o=r==parseInt(heure_debut)?o+'<option id="h_debut" selected>'+a+"</option>":o+'<option id="h_debut">'+a+"</option>"}for(var d="",r=0;60>r;r++){var a=0;10>r&&(a="0"+r),r>=10&&(a=r),d=r==parseInt(minute_debut)?d+'<option id="m_debut" selected>'+a+"</option>":d+'<option id="m_debut">'+a+"</option>"}for(var u="",r=parseInt(heure_debut);24>r;r++){var a=0;10>r&&(a="0"+r),r>=10&&(a=r),u=r==parseInt(heure_fin)?u+"<option selected>"+a+"</option>":u+"<option>"+a+"</option>"}var s="";if(heure_fin==heure_debut)for(var r=parseInt(minute_debut);60>r;r++){var a=0;10>r&&(a="0"+r),r>=10&&(a=r),s=r==parseInt(minute_fin)?s+"<option selected>"+a+"</option>":s+"<option>"+a+"</option>"}else for(var r=0;60>r;r++){var a=0;10>r&&(a="0"+r),r>=10&&(a=r),s=r==parseInt(minute_fin)?s+"<option selected>"+a+"</option>":s+"<option>"+a+"</option>"}$("#edit_heure_debut").html(o),$("#edit_minute_debut").html(d),$("#edit_heure_fin").html(u),$("#edit_minute_fin").html(s),$("#edit_heure_fin").change(function(e){heure_fin=$("#edit_heure_fin option:selected").html();var t="";if(heure_fin<=heure_debut)for(var i=parseInt(minute_debut)+1;60>i;i++){var n=0;10>i&&(n="0"+i),i>=10&&(n=i),t=i==parseInt(minute_fin)?t+"<option selected>"+n+"</option>":t+"<option>"+n+"</option>"}else for(var i=0;60>i;i++){var n=0;10>i&&(n="0"+i),i>=10&&(n=i),t=i==parseInt(minute_fin)?t+"<option selected>"+n+"</option>":t+"<option>"+n+"</option>"}$("#edit_minute_fin").html(t)}),$("#edit_minute_fin").change(function(e){minute_fin=$("#edit_minute_fin option:selected").html()}),$("#edit_heure_debut").change(function(e){console.log("click edit heure",$("#edit_heure_debut option:selected").html());var t=$("#edit_heure_debut option:selected").html();heure_debut=t;for(var i="",n=parseInt(t);24>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),i=n==parseInt(heure_fin)?i+"<option selected>"+o+"</option>":i+"<option>"+o+"</option>"}var r="";if(heure_fin<=t)for(var n=parseInt(minute_debut)+1;60>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),r=n==parseInt(minute_fin)?r+"<option selected>"+o+"</option>":r+"<option>"+o+"</option>"}else for(var n=0;60>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),r=n==parseInt(minute_fin)?r+"<option selected>"+o+"</option>":r+"<option>"+o+"</option>"}$("#edit_heure_fin").html(i),$("#edit_minute_fin").html(r)}),$("#edit_minute_debut").change(function(e){console.log("click edit minute",$("#edit_minute_debut option:selected").html());var t=$("#edit_minute_debut option:selected").html();minute_debut=t;var i="";if(heure_fin<=heure_debut)for(var n=parseInt(t)+1;60>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),i=n==parseInt(minute_fin)?i+"<option selected>"+o+"</option>":i+"<option>"+o+"</option>"}else for(var n=0;60>n;n++){var o=0;10>n&&(o="0"+n),n>=10&&(o=n),i=n==parseInt(minute_fin)?i+"<option selected>"+o+"</option>":i+"<option>"+o+"</option>"}$("#edit_minute_fin").html(i)})}})},buttons:{Modifier:function(){var e=$("#CodeActivite").find("option:selected").attr("value"),i=$("#CodeActivite").find("option:selected").html(),n=$("#CodeLieux").find("option:selected").attr("value"),o=$("#CodeLieux").find("option:selected").html(),r=$("#CodeCompagnie").find("option:selected").attr("value"),a=$("#CodeCompagnie").find("option:selected").html(),d=$("#CodeDispositif").find("option:selected").attr("value"),u=$("#CodeDispositif").find("option:selected").html(),s=jour_deb+" "+$("#edit_heure_debut").find("option:selected").html()+":"+$("#edit_minute_debut").find("option:selected").html()+":00",l=jour_deb+" "+$("#edit_heure_fin").find("option:selected").html()+":"+$("#edit_minute_fin").find("option:selected").html()+":00";console.log("event d",s),console.log("event f",l);var _=60*(60*parseInt(heure_debut)+parseInt(minute_debut)),p=60*(60*parseInt(heure_fin)+parseInt(minute_fin)),c=p-_,h=_/60/60*4*10,f=c/60/60*4*10;console.log("new height = ",f),console.log("id = ",t);$("#"+t).css("height",f+"px"),$("#"+t).css("marginTop",h+"px"),$("#"+t+"_date_debut_heure").replaceWith("<span>"+heure_debut+"</span>"),$("#"+t+"_date_debut_minute").replaceWith("<span>"+minute_debut+"</span>"),$("#"+t+"_date_fin_heure").replaceWith("<span>"+heure_fin+"</span>"),$("#"+t+"_date_fin_minute").replaceWith("<span>"+minute_fin+"</span>");if(f>=60){$("#"+t+"_activite").replaceWith('<div id="'+t+'_activite">'+i+"</div>")}if(f>=140){$("#"+t+"_lieu").replaceWith('<div id="'+t+'_lieu">'+o+"</div>")}if(f>=180){$("#"+t+"_compagnie").replaceWith('<div id="'+t+'_compagnie">'+a+"</div>"),$("#"+t+"_dispositif").replaceWith('<div id="'+t+'_dispositif">'+u+"</div>")}$("<div>Sauvegarde en cours</div>").appendTo(event).attr("id",t+"_tmp");$.ajax({url:"../occupation/edit/"+t,type:"POST",data:"CodeOccupation="+t+"&HeureDebut="+s+"&HeureFin="+l+"&CodeLieux="+n+"&CodeActivite="+e+"&CodeCompagnie="+r+"&CodeDispositif="+d,dataType:"html",success:function(e,i){console.log("modif success"),$("#"+t+"_tmp").remove()}}),$(this).dialog("destroy")},Annuler:function(){$(this).dialog("destroy")}}})}),$("div#container_top").corner("top cc:#4E6257"),$("div#header_content").corner("bottom cc:#4E6257"),$("div#visu_page_perso").corner(),$("div#footer").corner("bottom"),$(".lab_form").corner(),$(".identifiant").corner("round 9px"),$(".password").corner("round 9px"),$("#visu_mail").corner("round 9px cc:#CCD9C8"),$(".infosMail").corner("round 9px cc:#CCD9C8"),$(".contenuMail").corner(),$(".form_contenu").corner("round 9px"),$(".form_titre").corner("round 9px"),$(".form_cible").corner("round 9px"),$("#ajout_galerie").corner("round 5px"),$("#info_activation_module").corner(),$(".input_form").corner(),$(".form_list").corner(),$(".evenement_list_depart").corner(),$(".evenement_list_fin").corner(),$(".form_list_visible").corner(),$(".switcher_content_content").corner("left"),$(".calendar_event").corner("cc:#fff"),$(".calendar_event_date").corner("top cc:#fff"),$(".switcher_agenda_inside").corner("top"),$("div#select_agenda").corner("top"),$(".select_agenda_selector").corner("round 4px")}),function(e){function t(t,i){return parseInt(e.css(t,i))||0}function i(e){var e=parseInt(e).toString(16);return e.length<2?"0"+e:e}function n(t){for(;t&&"html"!=t.nodeName.toLowerCase();t=t.parentNode){var n=e.css(t,"backgroundColor");if("rgba(0, 0, 0, 0)"!=n){if(n.indexOf("rgb")>=0){var o=n.match(/\d+/g);return"#"+i(o[0])+i(o[1])+i(o[2])}if(n&&"transparent"!=n)return n}}return"#ffffff"}function o(e,t,i){switch(e){case"round":return Math.round(i*(1-Math.cos(Math.asin(t/i))));case"cool":return Math.round(i*(1+Math.cos(Math.asin(t/i))));case"sharp":return Math.round(i*(1-Math.cos(Math.acos(t/i))));case"bite":return Math.round(i*Math.cos(Math.asin((i-t-1)/i)));case"slide":return Math.round(i*Math.atan2(t,i/t));case"jut":return Math.round(i*Math.atan2(i,i-t-1));case"curl":return Math.round(i*Math.atan(t));case"tear":return Math.round(i*Math.cos(t));case"wicked":return Math.round(i*Math.tan(t));case"long":return Math.round(i*Math.sqrt(t));case"sculpt":return Math.round(i*Math.log(i-t-1,i));case"dog":return 1&t?t+1:i;case"dog2":return 2&t?t+1:i;case"dog3":return 3&t?t+1:i;case"fray":return t%2*i;case"notch":return i;case"bevel":return t+1}}var r=navigator.userAgent,a=e.browser.mozilla&&/gecko/i.test(r),d=e.browser.safari&&/Safari\/[5-9]/.test(r),u=e.browser.msie&&function(){var e=document.createElement("div");try{e.style.setExpression("width","0+0")}catch(t){return!1}return!0}();e.fn.corner=function(i){if(0==this.length){if(!e.isReady&&this.selector){var r=this.selector,s=this.context;e(function(){e(r,s).corner(i)})}return this}return this.each(function(r){var s=e(this),l=[i||"",s.attr(e.fn.corner.defaults.metaAttr)||""].join(" ").toLowerCase(),_=/keep/.test(l),p=(l.match(/cc:(#[0-9a-f]+)/)||[])[1],c=(l.match(/sc:(#[0-9a-f]+)/)||[])[1],h=parseInt((l.match(/(\d+)px/)||[])[1])||10,f=/round|bevel|notch|bite|cool|sharp|slide|jut|curl|tear|fray|wicked|sculpt|long|dog3|dog2|dog/,m=(l.match(f)||["round"])[0],v={T:0,B:1},$={TL:/top|tl|left/.test(l),TR:/top|tr|right/.test(l),BL:/bottom|bl|left/.test(l),BR:/bottom|br|right/.test(l)};if($.TL||$.TR||$.BL||$.BR||($={TL:1,TR:1,BL:1,BR:1}),e.fn.corner.defaults.useNative&&"round"==m&&(a||d)&&!p&&!c)return $.TL&&s.css(a?"-moz-border-radius-topleft":"-webkit-border-top-left-radius",h+"px"),$.TR&&s.css(a?"-moz-border-radius-topright":"-webkit-border-top-right-radius",h+"px"),$.BL&&s.css(a?"-moz-border-radius-bottomleft":"-webkit-border-bottom-left-radius",h+"px"),void($.BR&&s.css(a?"-moz-border-radius-bottomright":"-webkit-border-bottom-right-radius",h+"px"));var g=document.createElement("div");g.style.overflow="hidden",g.style.height="1px",g.style.backgroundColor=c||"transparent",g.style.borderStyle="solid";var b={T:parseInt(e.css(this,"paddingTop"))||0,R:parseInt(e.css(this,"paddingRight"))||0,B:parseInt(e.css(this,"paddingBottom"))||0,L:parseInt(e.css(this,"paddingLeft"))||0};void 0!=typeof this.style.zoom&&(this.style.zoom=1),_||(this.style.border="none"),g.style.borderColor=p||n(this.parentNode);var w=e.curCSS(this,"height");for(var I in v){var y=v[I];if(y&&($.BL||$.BR)||!y&&($.TL||$.TR)){g.style.borderStyle="none "+($[I+"R"]?"solid":"none")+" none "+($[I+"L"]?"solid":"none");var x=document.createElement("div");e(x).addClass("jquery-corner");var T=x.style;if(y?this.appendChild(x):this.insertBefore(x,this.firstChild),y&&"auto"!=w)"static"==e.css(this,"position")&&(this.style.position="relative"),T.position="absolute",T.bottom=T.left=T.padding=T.margin="0",u?T.setExpression("width","this.parentNode.offsetWidth"):T.width="100%";else if(!y&&e.browser.msie)if("static"==e.css(this,"position")&&(this.style.position="relative"),T.position="absolute",T.top=T.left=T.right=T.padding=T.margin="0",u){var C=t(this,"borderLeftWidth")+t(this,"borderRightWidth");T.setExpression("width","this.parentNode.offsetWidth - "+C+'+ "px"')}else T.width="100%";else T.position="relative",T.margin=y?b.B-h+"px -"+b.R+"px -"+b.B+"px -"+b.L+"px":"-"+b.T+"px -"+b.R+"px "+(b.T-h)+"px -"+b.L+"px";for(var k=0;h>k;k++){var M=Math.max(0,o(m,k,h)),H=g.cloneNode(!1);H.style.borderWidth="0 "+($[I+"R"]?M:0)+"px 0 "+($[I+"L"]?M:0)+"px",y?x.appendChild(H):x.insertBefore(H,x.firstChild)}}}})},e.fn.uncorner=function(){return(a||d)&&this.css(a?"-moz-border-radius":"-webkit-border-radius",0),e("div.jquery-corner",this).remove(),this},e.fn.corner.defaults={useNative:!0,metaAttr:"data-corner"}}(jQuery),$(function(){$(".RA_target").change(function(){var e=$(this).attr("id"),t=$(this).find("option:selected").attr("id");console.log("cat : "+e),console.log("cde : "+t),"new_event_categorieActivite"==e&&(targetCategorie="RA_activ",cat="activite"),"new_event_categorieLieu"==e&&(targetCategorie="RA_Lieu",cat="lieu"),$.ajax({url:"../candidat/request",type:"POST",data:"categorie="+cat+"&codeCategorie="+t,dataType:"html",success:function(e,t){console.log("succes"),console.log(e),$("."+targetCategorie).html(e)},error:function(e,t,i){alert(e.responseText)}})})}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){function t(e){return d.raw?e:encodeURIComponent(e)}function i(e){return d.raw?e:decodeURIComponent(e)}function n(e){return t(d.json?JSON.stringify(e):String(e))}function o(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(a," ")),d.json?JSON.parse(e):e}catch(t){}}function r(t,i){var n=d.raw?t:o(t);return e.isFunction(i)?i(n):n}var a=/\+/g,d=e.cookie=function(o,a,u){if(arguments.length>1&&!e.isFunction(a)){if(u=e.extend({},d.defaults,u),"number"==typeof u.expires){var s=u.expires,l=u.expires=new Date;l.setMilliseconds(l.getMilliseconds()+864e5*s)}return document.cookie=[t(o),"=",n(a),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join("")}for(var _=o?void 0:{},p=document.cookie?document.cookie.split("; "):[],c=0,h=p.length;h>c;c++){var f=p[c].split("="),m=i(f.shift()),v=f.join("=");if(o===m){_=r(v,a);break}o||void 0===(v=r(v))||(_[m]=v)}return _};d.defaults={},e.removeCookie=function(t,i){return e.cookie(t,"",e.extend({},i,{expires:-1})),!e.cookie(t)}}),$(function(){$("#dialog-tuto-mobile").dialog({resizable:!0,height:350,width:"100%",modal:!0,buttons:{Fermer:function(){$(this).dialog("close")},"Ne plus afficher cette fenêtre":function(){$.cookie("mobile_time_management","read"),$(this).dialog("close")}}}),$("#dialog-tuto-pc").dialog({resizable:!0,height:450,width:700,modal:!0,buttons:{Fermer:function(){$(this).dialog("close")},"Ne plus afficher cette fenêtre":function(){$.cookie("pc_time_management","read"),$(this).dialog("close")}}}),$("#supprCookiePc").click(function(e){$.removeCookie("pc_time_management"),location.reload(!0)}),$("#supprCookieMobile").click(function(e){$.removeCookie("mobile_time_management"),location.reload(!0)})});